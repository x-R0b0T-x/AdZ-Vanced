name: Build AdZ-Vanced EXE

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install ps2exe
      run: |
        Install-Module -Name ps2exe -Force -Scope CurrentUser
      shell: powershell
      
    - name: Build EXE
      run: |
        Import-Module ps2exe
        ps2exe -inputFile "AdZ-Vanced_v1.3.ps1" -outputFile "AdZ-Vanced.exe" -iconFile "logo.ico" -noConsole -title "AdZ-Vanced v1.3" -version "1.3.0.0" -company "KontacktzBot" -product "AdZ-Vanced" -copyright "Â© 2025 KontacktzBot"
      shell: powershell
      
    - name: Upload EXE artifact
      uses: actions/upload-artifact@v4
      with:
        name: AdZ-Vanced-exe
        path: AdZ-Vanced.exe
      
    - name: Create Release
      if: github.event_name == 'push' && github.ref == 'refs/heads/main'
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v1.3-build-${{ github.run_number }}
        name: AdZ-Vanced v1.3 Build ${{ github.run_number }}
        body: |
          ## AdZ-Vanced v1.3 - Build ${{ github.run_number }}
          
          ### Features
          - DNS configuration management
          - Automatic DNS backup
          - Support for IPv4 and IPv6
          - Premium GUI interface
          
          ### Download
          Download the `.exe` file below and run it with administrator privileges.
          
        files: AdZ-Vanced.exe
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
